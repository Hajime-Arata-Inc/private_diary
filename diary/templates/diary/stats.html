{% extends "base.html" %}
{% load form_filters %}

{% block content %}
    <h2 class="mb-4">📈 分析ページ</h2>

    <p class="text-muted">現在の総投稿数：<strong>{{ diary_count }}</strong> 件</p>

    <h3 class="mt-4">日別投稿数（リスト）</h3>
    <ul class="list-group mb-5">
    {% for item in daily_counts %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
        {{ item.date|date:"Y年m月d日" }}
        <span class="badge bg-primary rounded-pill">{{ item.count }} 件</span>
        </li>
    {% empty %}
        <li class="list-group-item">データがありません。</li>
    {% endfor %}
    </ul>

    <h3>📊 日別投稿グラフ</h3>
<div class="container p-4 mt-4 rounded" style="background-color: #ffffff;">
  <canvas id="diaryChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('diaryChart').getContext('2d');
const diaryChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: [
      {% for item in daily_counts %}
        "{{ item.date|date:'Y-m-d' }}"{% if not forloop.last %},{% endif %}
      {% endfor %}
    ],
    datasets: [{
      label: '投稿数',
      data: [
        {% for item in daily_counts %}
          {{ item.count }}{% if not forloop.last %},{% endif %}
        {% endfor %}
      ],
      fill: false,
      borderColor: 'rgba(54, 162, 235, 1)',
      borderWidth: 2,
      tension: 0.1,

      pointStyle: 'circle',                   // 塗りつぶし丸
      pointRadius: 4,
      pointHoverRadius: 6,
      pointBackgroundColor: 'rgba(54, 162, 235, 1)',
      pointBorderColor: '#fff',

      backgroundColor: 'transparent'
    }]
  },
  options: {
    plugins: {
      legend: {
        labels: {
          usePointStyle: true                 // 凡例を線風に
        }
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          stepSize: 1
        }
      }
    }
  }
});
</script>


<div class="text-center mt-4">
    <a href="/" class="btn btn-secondary">日記一覧へ戻る</a>
</div>


{% endblock %}
